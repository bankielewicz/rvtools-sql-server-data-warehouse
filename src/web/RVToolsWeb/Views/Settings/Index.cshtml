@model RVToolsWeb.Models.ViewModels.Admin.SettingsIndexViewModel
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@{
    ViewData["Title"] = "Settings";
    var requestToken = Antiforgery.GetAndStoreTokens(Context).RequestToken;
}

<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
                <i class="bi bi-gear me-2"></i>Settings
            </h4>
        </div>
    </div>
</div>

@if (TempData["SettingsSuccess"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        <i class="bi bi-check-circle me-2"></i>
        @TempData["SettingsSuccess"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["SettingsError"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show">
        <i class="bi bi-exclamation-triangle me-2"></i>
        @TempData["SettingsError"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Toast for AJAX notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    <div id="settingsToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-check-circle text-success me-2" id="toastIconSuccess"></i>
            <i class="bi bi-exclamation-triangle text-danger me-2 d-none" id="toastIconError"></i>
            <strong class="me-auto" id="toastTitle">Settings</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>
</div>

<!-- Tab Navigation -->
<ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
    <li class="nav-item">
        <button class="nav-link @(Model.ActiveTab == "general" ? "active" : "")"
                data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">
            <i class="bi bi-sliders me-1"></i>General
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(Model.ActiveTab == "retention" ? "active" : "")"
                data-bs-toggle="tab" data-bs-target="#retention" type="button" role="tab">
            <i class="bi bi-calendar3 me-1"></i>Table Retention
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(Model.ActiveTab == "application" ? "active" : "")"
                data-bs-toggle="tab" data-bs-target="#application" type="button" role="tab">
            <i class="bi bi-app me-1"></i>Application
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(Model.ActiveTab == "status" ? "active" : "")"
                data-bs-toggle="tab" data-bs-target="#status" type="button" role="tab">
            <i class="bi bi-database me-1"></i>Database Status
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(Model.ActiveTab == "metadata" ? "active" : "")"
                data-bs-toggle="tab" data-bs-target="#metadata" type="button" role="tab">
            <i class="bi bi-table me-1"></i>Metadata
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="settingsTabContent">
    <div class="tab-pane fade @(Model.ActiveTab == "general" ? "show active" : "")" id="general" role="tabpanel">
        <partial name="_GeneralSettingsPartial" model="Model.GeneralSettings" />
    </div>
    <div class="tab-pane fade @(Model.ActiveTab == "retention" ? "show active" : "")" id="retention" role="tabpanel">
        <partial name="_TableRetentionPartial" model="Model" />
    </div>
    <div class="tab-pane fade @(Model.ActiveTab == "application" ? "show active" : "")" id="application" role="tabpanel">
        <partial name="_AppSettingsPartial" model="Model.AppSettings" />
    </div>
    <div class="tab-pane fade @(Model.ActiveTab == "status" ? "show active" : "")" id="status" role="tabpanel">
        <partial name="_DatabaseStatusPartial" model="Model.DatabaseStatus" />
    </div>
    <div class="tab-pane fade @(Model.ActiveTab == "metadata" ? "show active" : "")" id="metadata" role="tabpanel">
        <partial name="_MetadataPartial" model="Model" />
    </div>
</div>

<!-- Anti-forgery token for AJAX requests -->
<input type="hidden" name="__RequestVerificationToken" value="@requestToken" />

@section Scripts {
    <script src="~/js/admin-settings.js" asp-append-version="true"></script>
}
